---
layout: layouts/base.njk
pagination:
  data: exhibitions.list
  size: 1
  alias: exhibition
  addAllPagesToCollections: true
bodyClass: exhibitions-body
---

{% from "components/hero.njk" import render as exhibitionHero %}
{# {% from "components/slider.njk" import render as exhibitionSlider %} #}

{% set slug = exhibition.slug or exhibition.id %}
{% set navigationMap = exhibitions.navigation or {} %}
{% set sliderMap = exhibitions.sliders or {} %}
{% set navigationEntry = navigationMap[slug] %}
{# {% set sliderEntry = sliderMap[slug] %} #}
{# {% set relatedExhibitions = navigationEntry.related or [] %} #}
{% set ogImage = exhibition.heroImage.src %}

{% block head %}
  <link rel="preload" as="image" href="{{ exhibition.heroImage.src }}" type="image/jpeg" />
  {% if sliderEntry and sliderEntry.items and sliderEntry.items[0].image %}
    {# <link rel="preload" as="image" href="{{ sliderEntry.items[0].image.src }}" type="image/jpeg" /> #}
  {% endif %}
{% endblock %}

<article class="exhibition-detail" data-exhibition-detail>
  {{ exhibitionHero(exhibition, navigationEntry.breadcrumbs | default([])) | safe }}

  {% if sliderEntry %}
    <section class="exhibition-detail__slider" aria-label="注目作品スライダー">
      {{ exhibitionSlider(sliderEntry) | safe }}
    </section>
  {% endif %}

  <section class="exhibition-detail__about surface">
    <h2 class="section-title">概要</h2>
    <div class="exhibition-detail__copy">
      {% if exhibition.summary %}
        <p>{{ exhibition.summary }}</p>
      {% endif %}
      {% if exhibition.background %}
        <p>{{ exhibition.background }}</p>
      {% endif %}
    </div>
    <div class="exhibition-detail__links">
      <a class="button" href="{{ exhibition.officialUrl }}" target="_blank" rel="noopener">公式サイト</a>
      {# {% if navigationEntry.cta and navigationEntry.cta.url %}
        <a class="button" href="{{ navigationEntry.cta.url }}">{{ navigationEntry.cta.label.ja }}</a>
      {% endif %} #}
    </div>
    {% if  exhibition.audioUrl %}
    <iframe src="{{ exhibition.audioUrl | toStandFmEmbedUrl }}" class="standfm-embed-iframe" width="100%" frameborder="0" allowtransparency="true" allow="encrypted-media" loading="lazy"></iframe>
    {% endif %}

  </section>

  <section class="exhibition-detail__artworks surface">
    <h2 class="section-title">収録作品</h2>
    {% if exhibition.artworkList and exhibition.artworkList | length > 0 %}
      <ul class="exhibition-detail__artwork-grid">
        {% for artwork in exhibition.artworkList %}
          <li class="exhibition-detail__artwork-card">
            <article>
              {# <a class="exhibition-detail__artwork-link" href="/exhibitions/{{ slug }}/{{ artwork.artworkId }}/"> #}
                {# <div class="exhibition-detail__artwork-media" data-test="artwork-card-media">
                  <img src="{{ artwork.image.src or artwork.image }}" alt="{{ artwork.title }}" loading="lazy" decoding="async" />
                </div> #}
                <div class="exhibition-detail__artwork-body">
                  <h3>{% if artwork.displayId %}{{ artwork.displayId }} {% endif %}{{ artwork.title }}</h3>
                  {% if artwork.artistName %}
                    <p class="exhibition-detail__artwork-artist">{{ artwork.artistName }}</p>
                  {% endif %}
                  {% if artwork.description %}
                    <p class="exhibition-detail__artwork-description">{{ artwork.description }}</p>
                  {% endif %}
                </div>
              {# </a> #}
              <iframe src="{{ artwork.audioUrl | toStandFmEmbedUrl }}" class="standfm-embed-iframe" width="100%" frameborder="0" allowtransparency="true" allow="encrypted-media" loading="lazy"></iframe>
            </article>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="exhibition-detail__artwork-empty">現在公開できる作品情報がありません。</p>
    {% endif %}
  </section>

  {% if exhibition.relatedUrls and exhibition.relatedUrls | length > 0 %}
    <section class="exhibition-detail__resources surface">
      <h2 class="section-title">関連リンク</h2>
      <ul class="exhibition-detail__resource-list">
        {% for link in exhibition.relatedUrls %}
          <li><a href="{{ link.url }}" target="_blank" rel="noopener">{{ link.label }}</a></li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}

  {% if relatedExhibitions | length > 0 %}
    <section class="exhibition-detail__related surface">
      <h2 class="section-title">関連する展示会</h2>
      <ul class="exhibition-detail__related-list">
        {% for relatedSlug in relatedExhibitions %}
          {% set related = exhibitions.list | selectattr('slug', 'equalto', relatedSlug) | first %}
          {% if not related %}
            {% set related = exhibitions.list | selectattr('id', 'equalto', relatedSlug) | first %}
          {% endif %}
          {% if related %}
            <li><a href="{{ related.detailUrl or '/exhibitions/' ~ (related.slug or related.id) ~ '/' }}">{{ related.title }}</a></li>
          {% endif %}
        {% endfor %}
      </ul>
    </section>
  {% endif %}
</article>
