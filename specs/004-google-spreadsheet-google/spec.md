# Feature Specification: 展示会作品一覧の表示

**Feature Branch**: `004-google-spreadsheet-google`
**Created**: 2025-10-11
**Status**: Draft
**Input**: User description: "Google Spreadsheetから各展示会の作品一覧を取得し、展示会詳細ページに作品一覧を表示する。Google Spreadsheetから取得できる列は 入力日, 展示会ID, 作品ID, 展覧会名, 展示ID, アーティスト名, 作品名, 作品詳細, その他, 作品紹介（Google Drive URL）, 参照URL, 音声化（stand fm url）, 記事化（Note url）, image であり、表示するのは 作品ID、アーティスト名、作品名と音声化（stand fm url） である。音声化（stand fm url）はStand.fmのEmbed codeに変換して表示する。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 作品基本情報の閲覧 (Priority: P1)

展示会詳細ページを訪れた訪問者が、その展示会で展示されている作品の一覧（作品ID、アーティスト名、作品名）を見ることができる。

**Why this priority**: 展示会に含まれる作品の基本情報を提供することは、訪問者が展示会の内容を理解し、訪問を決定する上で最も重要な要素です。この情報がなければ、展示会の魅力を十分に伝えることができません。

**Independent Test**: 作品データが登録されている展示会の詳細ページにアクセスし、作品一覧セクションが表示され、各作品の作品ID、アーティスト名、作品名が正しく表示されることを確認することで、独立してテスト可能です。

**Acceptance Scenarios**:

1. **Given** 展示会に3つの作品が紐づいている場合、**When** 訪問者が展示会詳細ページを表示する、**Then** 作品一覧セクションに3つの作品が表示される
2. **Given** 作品にアーティスト名と作品名が登録されている場合、**When** 作品一覧が表示される、**Then** 各作品カードにアーティスト名と作品名が明確に表示される
3. **Given** 作品に作品IDが設定されている場合、**When** 作品一覧が表示される、**Then** 各作品カードに作品IDが表示される

---

### User Story 2 - 音声ガイドの視聴 (Priority: P2)

展示会詳細ページを訪れた訪問者が、各作品に関連付けられた音声ガイド（Stand.fm）がある場合、それを再生できる。

**Why this priority**: 音声ガイドは作品理解を深める付加価値機能です。基本情報の表示が完了した後に追加することで、段階的に価値を提供できます。全ての作品に音声ガイドがあるとは限らないため、P2としています。

**Independent Test**: Stand.fmのURLが登録されている作品を持つ展示会詳細ページにアクセスし、作品カードにStand.fmの埋め込みプレーヤーが表示され、再生できることを確認することで、独立してテスト可能です。

**Acceptance Scenarios**:

1. **Given** 作品にStand.fmのURLが登録されている場合、**When** 作品一覧が表示される、**Then** その作品カードにStand.fmの埋め込みプレーヤーが表示される
2. **Given** Stand.fmの埋め込みプレーヤーが表示されている場合、**When** 訪問者が再生ボタンをクリックする、**Then** 音声ガイドが再生される
3. **Given** 作品にStand.fmのURLが登録されていない場合、**When** 作品一覧が表示される、**Then** その作品カードには音声プレーヤーは表示されない

---

### User Story 3 - 作品なし状態の適切な表示 (Priority: P3)

展示会に作品が登録されていない場合でも、展示会詳細ページが適切に表示され、訪問者に混乱を与えない。

**Why this priority**: エラーハンドリングと空状態の処理は重要ですが、主要機能が動作した後に対応すべき項目です。展示会には必ず作品が登録されることを前提とした運用が可能であれば、優先度は低くなります。

**Independent Test**: 作品データが登録されていない展示会の詳細ページにアクセスし、エラーが発生せず、適切なメッセージまたは空状態が表示されることを確認することで、独立してテスト可能です。

**Acceptance Scenarios**:

1. **Given** 展示会に作品が1つも登録されていない場合、**When** 訪問者が展示会詳細ページを表示する、**Then** ページはエラーなく表示され、作品一覧セクションには「作品情報は準備中です」などのメッセージが表示される
2. **Given** 作品は登録されているが必須項目が欠落している場合、**When** データ変換処理が実行される、**Then** その作品はスキップされ、有効な作品のみが表示される

---

### Edge Cases

- 展示会IDが作品スプレッドシートに存在しない場合、どのように処理するか？
- Stand.fmのURLが無効または形式が不正な場合、どのように処理するか？
- 作品スプレッドシートのヘッダー列が期待される順序と異なる場合、どのように検出・処理するか？
- 同じ展示会IDに対して重複する作品IDが存在する場合、どのように処理するか？
- アーティスト名や作品名に特殊文字（HTML特殊文字、絵文字など）が含まれる場合、適切にエスケープされるか？
- Google Sheetsからのデータ取得が失敗した場合（ネットワークエラー、認証エラーなど）、ビルドは失敗すべきか、それとも既存データで継続すべきか？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは作品情報を格納するGoogle Spreadsheetから、展示会IDに紐づく作品一覧を取得しなければならない
- **FR-002**: システムは取得した作品データから、作品ID、展示会ID、アーティスト名、作品名、音声化URLを抽出しなければならない
- **FR-003**: システムは作品ID、アーティスト名、作品名のいずれかが欠落している作品行をスキップし、警告ログを出力しなければならない
- **FR-004**: システムは展示会IDをキーとして、その展示会に属する作品の配列を構築しなければならない
- **FR-005**: 展示会詳細ページテンプレートは、その展示会に紐づく作品一覧を表示しなければならない
- **FR-006**: 各作品の表示には、作品ID、アーティスト名、作品名を含めなければならない
- **FR-007**: システムは作品に音声化URL（Stand.fm）が存在する場合、そのURLをStand.fmの埋め込みコードに変換しなければならない
- **FR-008**: Stand.fmの埋め込みコードは、作品カード内に適切にレンダリングされなければならない
- **FR-009**: システムは作品スプレッドシートのヘッダー行を検証し、期待される列構成と一致しない場合はエラーを発生させなければならない
- **FR-010**: 展示会に紐づく作品が1つも存在しない場合、展示会詳細ページはエラーなく表示され、作品一覧セクションには適切なメッセージまたは空状態を表示しなければならない

### Key Entities

- **作品 (Artwork)**: 展示会に展示される個別の美術作品を表現するエンティティ。作品ID、展示会ID、アーティスト名、作品名、音声化URLを属性として持つ
- **展示会 (Exhibition)**: 作品を含む展示イベントを表現するエンティティ。複数の作品との1対多の関連を持つ
- **音声化URL (Audio Guide URL)**: Stand.fmでホストされている音声ガイドへのリンク。埋め込みコードに変換可能な形式

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 作品が登録されている展示会の詳細ページにアクセスした訪問者の100%が、作品一覧を閲覧できる
- **SC-002**: 各作品の基本情報（作品ID、アーティスト名、作品名）が正確に表示される正確性が100%である
- **SC-003**: Stand.fmのURLが登録されている作品の100%で、埋め込みプレーヤーが正しく機能する
- **SC-004**: 作品データの取得と変換がページビルド時間に50ミリ秒以内の影響しか与えない
- **SC-005**: 作品が登録されていない展示会の詳細ページも、エラーなく正常に表示される

## Out of Scope

- 作品の画像表示（作品紹介Google Drive URLの処理）
- 作品詳細ページの作成
- 作品の並び順のカスタマイズ機能
- 作品のフィルタリングや検索機能
- 記事化（Note URL）の表示
- 参照URLの表示
- 作品詳細情報やその他のフィールドの表示
- 管理者による作品データの編集機能（Google Sheets経由での更新のみサポート）

## Assumptions

- 作品情報を格納するGoogle Spreadsheetは、展示会情報のスプレッドシートとは別のシートまたは別のスプレッドシート内に存在する
- 作品スプレッドシートのヘッダー行は固定された順序で列が定義されている（入力日, 展示会ID, 作品ID, 展覧会名, 展示ID, アーティスト名, 作品名, 作品詳細, その他, 作品紹介, 参照URL, 音声化, 記事化, image）
- Google Sheets APIへの認証は既存の展示会データ取得と同じ認証機構を使用する
- Stand.fmのURLは標準的な形式（`https://stand.fm/episodes/...`）であり、埋め込みコードへの変換パターンは安定している
- Stand.fmの埋め込みiframeは、レスポンシブデザインに対応可能である
- 作品データは静的サイトビルド時に取得され、クライアントサイドでの動的取得は行わない
- 1つの展示会に紐づく作品数は最大100作品程度を想定している
- 作品IDは展示会内で一意である

## Dependencies

- Google Sheets APIクライアント（`src/_data/googleSheets.ts`）が正常に動作している
- 既存の展示会データ読み込み処理（`src/_data/exhibitions.ts`）が正常に動作している
- 展示会詳細ページテンプレート（`src/pages/exhibitions/[exhibitionId]/index.njk`）が作品一覧セクションを追加できる構造である
- Nunjucksテンプレートエンジンがデータの受け渡しに使用されている
- 環境変数に作品スプレッドシートのIDと範囲が設定可能である
