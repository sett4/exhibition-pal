{% extends "layouts/exhibitions.njk" %}
{% from "../components/exhibitions-hero.njk" import exhibitionsHero %}
{% from "../components/exhibition-highlights.njk" import exhibitionHighlights %}
{% from "../components/page-footer-cta.njk" import pageFooterCta %}
{% from "../components/artwork-list.njk" import renderArtworkList %}

{% block page_title %}{{ exhibition.title }}{% endblock %}
{% block meta_description %}{{ exhibition.summary }}{% endblock %}

{% block hero %}
    {{ exhibitionsHero(exhibition, heroMedia, exhibition.title, exhibition.summary, "detail") }}
{% endblock %}

{% block content %}
  <div class="flex flex-col gap-16">
    {% if exhibition.galleryImages and exhibition.galleryImages | length > 0 %}
      <section
        aria-label="展示ギャラリー"
        class="grid gap-6 sm:grid-cols-2"
        data-testid="exhibition-gallery"
      >
        {% for image in exhibition.galleryImages %}
          <figure class="overflow-hidden rounded-3xl shadow-card">
            <img
              src="{{ image }}"
              alt="{{ exhibition.title }} ギャラリー {{ loop.index }}"
              class="h-full w-full object-cover"
              loading="lazy"
              data-testid="gallery-image"
            />
          </figure>
        {% endfor %}
      </section>
    {% endif %}

    {% set overviewSection = sections | selectattr("slug", "equalto", "overview") | first %}
    <section class="flex flex-col gap-6" data-testid="exhibition-section" data-section-slug="{{ overviewSection.slug }}">
      <div class="flex items-center gap-3">
        <h2 class="text-2xl font-bold md:text-3xl">{{ overviewSection.title }}</h2>
      </div>
      <p class="text-lg leading-relaxed text-neutral-700">
        {{ overviewSection.body | safe }}
      </p>
      {% if exhibition.standfmEmbedCode %}
        <div class="aspect-w-16 aspect-h-9">
          {{ exhibition.standfmEmbedCode | safe }}
        </div>
      {% endif %}
    </section>

    {{ renderArtworkList(exhibition.artworkList) }}

    {% set accessSection = sections | selectattr("slug", "equalto", "access") | first %}
    <section class="flex flex-col gap-6" data-testid="exhibition-section" data-section-slug="{{ accessSection.slug }}">
      <div class="flex items-center gap-3">
        <h2 class="text-2xl font-bold md:text-3xl">{{ accessSection.title }}</h2>
      </div>
      <p class="text-lg leading-relaxed text-neutral-700">
        {{ accessSection.body | safe }}
      </p>
    </section>

  </div>
{% endblock %}
